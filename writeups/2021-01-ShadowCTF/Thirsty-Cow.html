<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>My Blog - 2021-01-ShadowCTF - Thirsty-Cow</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Abraxus">
    <!-- FontAwesome JS-->
    <script defer src="../../assets/js/fontawesome.min.js"></script>

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="../../assets/css/style.css">
    <link id="theme-style" rel="stylesheet" href="../../assets/css/prism.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-90D3KJBRDM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-90D3KJBRDM');
    </script>
</head>
<body class="theme-bg-light">

    <header class="header text-center">
    <h1 class="blog-name pt-lg-4 mb-0"><a class="no-text-decoration" href="index.html">Abraxus's Blog</a></h1>

    <nav class="navbar navbar-expand-lg navbar-dark">

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navigation" class="collapse navbar-collapse flex-column">
            <div class="profile-section pt-3 pt-lg-0">
                <img class="profile-image mb-3 rounded-circle mx-auto" src="../../assets/images/profile.png" alt="image">

                <div class="bio mb-3">Student<br>REV @ K3RN3L4RMY</div><!--//bio-->
                <ul class="social-list list-inline py-3 mx-auto">
                    <li class="list-inline-item"><a href="https://twitter.com/Abraxus7331" target="_blank"><i class="fab fa-twitter fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://github.com/Kasimir123" target="_blank"><i class="fab fa-github-alt fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://www.linkedin.com/in/kasimir-schulz" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i></a></li>
                </ul><!--//social-list-->
                <hr>
            </div><!--//profile-section-->

            <ul class="navbar-nav flex-column text-center">
                <li class="nav-item">
                    <a class="nav-link" href="../../index.html"><i class="fas fa-home fa-fw me-2"></i>Blog Home <i class="fas fa-home fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../about.html"><i class="fas fa-user fa-fw me-2"></i>About Me <i class="fas fa-user fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../blog-posts.html"><i class="fas fa-bookmark fa-fw me-2"></i>Blog Posts <i class="fas fa-bookmark fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../writeups.html"><i class="fas fa-flag fa-fw me-2"></i>Writeups <i class="fas fa-flag fa-fw me-2"></i></a>
                </li>
            </ul>

            <div class="my-2 my-md-3 text-center">
                <a class="btn btn-primary" href="https://github.com/Kasimir123" target="_blank">Get in Touch</a>
            </div>
        </div>
    </nav>
</header>

    <div class="main-wrapper">

        <article class="markdown-section my-5 mx-5">
            <h1 id="shadowctf-thirsty-cow-write-up">ShadowCTF thirsty cow Write Up</h1>
<h2 id="details">Details:</h2>
<p>Points: 300</p>
<p>Jeopardy style CTF</p>
<p>Category: Reversing</p>
<h2 id="write-up">Write up:</h2>
<p>The challenge gave us an ELF 64 bit LSB shared object. I tried running strings and found nothing useful so I opened the file in IDA and got the following pseudocode.</p>
<pre><code class="language-cpp">int __cdecl main(int argc, const char **argv, const char **envp)
{
  __int64 v3; // rax
  __int64 v4; // rax
  __int64 v5; // rax
  __int64 v6; // rax
  __int64 v7; // rax
  __int64 v8; // rax
  __int64 v9; // rax
  __int64 v10; // rax
  char v12[36]; // [rsp+0h] [rbp-170h] BYREF
  char v13[9]; // [rsp+24h] [rbp-14Ch] BYREF
  char v14[3]; // [rsp+2Dh] [rbp-143h] BYREF
  char v15[4]; // [rsp+30h] [rbp-140h] BYREF
  char v16[10]; // [rsp+34h] [rbp-13Ch] BYREF
  char v17[11]; // [rsp+3Eh] [rbp-132h] BYREF
  char v18[4]; // [rsp+49h] [rbp-127h] BYREF
  char v19[3]; // [rsp+4Dh] [rbp-123h] BYREF
  char v20[4]; // [rsp+50h] [rbp-120h] BYREF
  char v21[4]; // [rsp+54h] [rbp-11Ch] BYREF
  char v22[4]; // [rsp+58h] [rbp-118h] BYREF
  char v23[4]; // [rsp+5Ch] [rbp-114h] BYREF
  char v24[268]; // [rsp+60h] [rbp-110h] BYREF

  strcpy(v23, "_si");
  strcpy(v22, "sin");
  strcpy(v21, "_5i");
  strcpy(v20, "rty");
  strcpy(v19, "th");
  strcpy(v18, "x_r");
  strcpy(&v17[7], "_th");
  strcpy(&v17[5], "x");
  strcpy(v17, "irty");
  strcpy(v16, v19);
  strcat(v16, v17);
  v3 = std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(
         &std::cout,
         " The crow is thirsty and he needs your help to gather stones to fill the pot");
  v4 = std::ostream::operator&#x3C;&#x3C;(v3, &std::endl&#x3C;char,std::char_traits&#x3C;char>>);
  std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(v4, " > ");
  std::operator>>&#x3C;char,std::char_traits&#x3C;char>>(&std::cin, v24);
  strcat(v16, v23);
  strcat(v16, &v17[5]);
  if ( strcmp(v24, v16) )
  {
    v10 = std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(&std::cout, " Not enough stones :( ");
    std::ostream::operator&#x3C;&#x3C;(v10, &std::endl&#x3C;char,std::char_traits&#x3C;char>>);
  }
  else
  {
    strcpy(v15, "Thi");
    strcpy(v14, "e_");
    strcpy(&v13[6], "ck");
    strcpy(&v13[4], "0");
    strcpy(v13, "p0t");
    strcpy(v12, v15);
    strcat(v12, v20);
    strcat(v12, v21);
    strcat(v12, v18);
    strcat(v12, &v13[4]);
    strcat(v12, &v13[6]);
    strcat(v12, v22);
    strcat(v12, &v17[7]);
    strcat(v12, v14);
    strcat(v12, v13);
    v5 = std::ostream::operator&#x3C;&#x3C;(&std::cout, &std::endl&#x3C;char,std::char_traits&#x3C;char>>);
    v6 = std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(v5, "shadowCTF{");
    v7 = std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(v6, v12);
    v8 = std::operator&#x3C;&#x3C;&#x3C;std::char_traits&#x3C;char>>(v7, "} ");
    v9 = std::ostream::operator&#x3C;&#x3C;(v8, &std::endl&#x3C;char,std::char_traits&#x3C;char>>);
    std::ostream::operator&#x3C;&#x3C;(v9, &std::endl&#x3C;char,std::char_traits&#x3C;char>>);
  }
  return 0;
}</code></pre>
<p>Seeing this I knew that I would simply be able to run the file in the debugger and change the value of eax to make the code go into the else statement.</p>
<p>I started my linux debugger and set a breakpoint on the if statement. When prompted for the keyphrase I put in a random string.</p>
<pre><code class="language-text">.text:00005572417C22BC mov     rsi, rdx                        ; src
.text:00005572417C22BF mov     rdi, rax                        ; dest
.text:00005572417C22C2 call    _strcat
.text:00005572417C22C7 lea     rdx, [rbp+dest+7]
.text:00005572417C22CE lea     rax, [rbp+s1]
.text:00005572417C22D5 mov     rsi, rdx                        ; s2
.text:00005572417C22D8 mov     rdi, rax                        ; s1
.text:00005572417C22DB call    _strcmp
.text:00005572417C22E0 mov     [rbp+var_4], eax
.text:00005572417C22E3 cmp     [rbp+var_4], 0
.text:00005572417C22E7 jnz     loc_5572417C2499
.text:00005572417C22ED mov     dword ptr [rbp+dest+3], 696854h
.text:00005572417C22F7 mov     word ptr [rbp+dest], 5F65h
.text:00005572417C2300 mov     [rbp+dest+2], 0</code></pre>
<p>I noticed that after the strcmp call the value of eax was put into rbp+var_4 so I stepped to the mov instruction and changed the eax value to 0 and pressed continue. The flag was then printed.</p>
<pre><code class="language-text"> The crow is thirsty and he needs your help to gather stones to fill the pot
 > sdffsd

shadowCTF{Thirty_5ix_r0cksin_the_p0t} </code></pre>
        </article>

        <footer class="footer text-left py-2 theme-bg-dark">

    <small class="copyright">&nbsp;Generated by <a href="https://github.com/Kasimir123/Blog-Generator" target="_blank">Blog Generator</a> from Kasimir123</small>

</footer>

    </div><!--//main-wrapper-->
    <!-- Javascript -->
    <script src="../../assets/js/popper.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js"></script>
    <script src="../../assets/js/prism.js"></script>
</body>
</html>